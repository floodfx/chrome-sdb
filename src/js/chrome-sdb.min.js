(function(){var SHA1;
SHA1=function(){var e,a,b,d,f,c,k,l,p,o,m,t,v,r;d={};o=function(h){return e(a(k(h),h.length*8))};p=function(h,i){var j,g,q,n;j=k(h);if(j.length>16)j=a(j,h.length*8);q=Array(16);n=Array(16);for(g=0;g<16;g++){q[g]=j[g]^909522486;n[g]=j[g]^1549556828}j=a(q.concat(k(i)),512+i.length*8);return e(a(n.concat(j),672))};l=function(h,i){var j,g,q,n,s;if(i==null)i=true;j=i?"0123456789abcdef":"0123456789ABCDEF";q="";g=0;for(s=h.length;0<=s?g<s:g>s;0<=s?g++:g--){n=h.charCodeAt(g);q+=j.charAt(n>>>4&15)+j.charAt(n&
15)}return q};c=function(h,i){var j,g,q,n,s;if(i==null)i="=";n="";q=h.length;for(j=0;j<q;j+=3){s=h.charCodeAt(j)<<16|(j+1<q?h.charCodeAt(j+1)<<8:0)|(j+2<q?h.charCodeAt(j+2):0);for(g=0;g<4;g++)n+=j*8+g*6>h.length*8?i:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(s>>>6*(3-g)&63)}return n};f=function(h,i){var j,g,q,n,s,w,u,x;g=i.length;q=[];j=Array(Math.ceil(h.length/2));n=0;for(s=j.length;0<=s?n<s:n>s;0<=s?n++:n--)j[n]=h.charCodeAt(n*2)<<8|h.charCodeAt(n*2+1);for(;j.length>
0;){w=[];n=u=0;for(x=j.length;0<=x?n<x:n>x;0<=x?n++:n--){u=(u<<16)+j[n];s=Math.floor(u/g);u-=s*g;if(w.length>0||s>0)w[w.length]=s}q[q.length]=u;j=w}j="";for(n=g=q.length-1;g<=0?n<=0:n>=0;g<=0?n++:n--)j+=i.charAt(q[n]);q=Math.ceil(h.length*8/(Math.log(i.length)/Math.log(2)));for(n=g=j.length;g<=q?n<=q:n>=q;g<=q?n++:n--)j=i[0]+j;return j};r=function(h){var i,j,g,q,n;j="";i=0;for(n=h.length;0<=n?i<n:i>n;0<=n?i++:i--){g=h.charCodeAt(i);q=i+1<h.length?h.charCodeAt(i+1):0;if(55296<=g&&g<=56319&&56320<=
q&&q<=57343){g=65536+((g&1023)<<10)+(q&1023);i++}if(g<=127)j+=String.fromCharCode(g);else if(g<=2047)j+=String.fromCharCode(192|g>>>6&31,128|g&63);else if(g<=65535)j+=String.fromCharCode(224|g>>>12&15,128|g>>>6&63,128|g&63);else if(g<=2097151)j+=String.fromCharCode(240|g>>>18&7,128|g>>>12&63,128|g>>>6&63,128|g&63)}return j};k=function(h){var i,j,g;j=Array(h.length>>2);i=0;for(g=j.length;0<=g?i<g:i>g;0<=g?i++:i--)j[i]=0;i=0;for(g=h.length*8;i<g;i+=8)j[i>>5]|=(h.charCodeAt(i/8)&255)<<24-i%32;return j};
e=function(h){var i,j,g;j="";i=0;for(g=h.length*32;i<g;i+=8)j+=String.fromCharCode(h[i>>5]>>>24-i%32&255);return j};a=function(h,i){var j,g,q,n,s,w,u,x,z,A,B,C,D,y,E;h[i>>5]|=128<<24-i%32;h[(i+64>>9<<4)+15]=i;y=Array(80);j=1732584193;g=-271733879;q=-1732584194;n=271733878;s=-1009589776;w=0;for(E=h.length;w<E;w+=16){x=j;z=g;A=q;B=n;C=s;for(u=0;u<80;u++){y[u]=u<16?h[w+u]:b(y[u-3]^y[u-8]^y[u-14]^y[u-16],1);D=m(m(b(j,5),t(u,g,q,n)),m(m(s,y[u]),v(u)));s=n;n=q;q=b(g,30);g=j;j=D}j=m(j,x);g=m(g,z);q=m(q,
A);n=m(n,B);s=m(s,C)}return Array(j,g,q,n,s)};t=function(h,i,j,g){return h<20?i&j|~i&g:h<40?i^j^g:h<60?i&j|i&g|j&g:i^j^g};v=function(h){return h<20?1518500249:h<40?1859775393:h<60?-1894007588:-899497514};m=function(h,i){var j;j=(h&65535)+(i&65535);return(h>>16)+(i>>16)+(j>>16)<<16|j&65535};b=function(h,i){return h<<i|h>>>32-i};d.hex_sha1=function(h){return l(o(r(h)))};d.b64_sha1=function(h){return c(o(r(h)))};d.any_sha1=function(h,i){return f(o(r(h)),i)};d.hex_hmac_sha1=function(h,i){return l(p(r(h),
r(i)))};d.b64_hmac_sha1=function(h,i){return c(p(r(h),r(i)))};d.any_hmac_sha1=function(h,i,j){return f(p(r(h),r(i)),j)};return d}();var Storage;Storage=function(){var e;e={};e.get=function(a,b){var d;if(b==null)b=false;d=localStorage.getItem(a);if(b)d=JSON.parse(d);return d};e.set=function(a,b,d){if(d==null)d=false;if(d)b=JSON.stringify(b);localStorage.setItem(a,b);return b};e.del=function(a){return localStorage.removeItem(a)};return e}();var Settings;
Settings=function(){function e(a,b,d,f,c){this.access_key=a;this.secret_key=b;this.region=d!=null?d:"sdb.amazonaws.com";this.version=f!=null?f:"2009-04-15";this.https_protocol=c!=null?c:false}e.prototype.use_access_key=function(a){this.access_key=a;return this};e.prototype.use_secret_key=function(a){this.secret_key=a;return this};e.prototype.use_region=function(a){this.region=a;return this};e.prototype.use_version=function(a){this.version=a;return this};e.prototype.use_https_protocol=function(a){this.https_protocol=
a;return this};e.prototype.get_access_key=function(){return this.access_key};e.prototype.get_secret_key=function(){return this.secret_key};e.prototype.get_region=function(){return this.region};e.prototype.get_version=function(){return this.version};e.prototype.get_use_https=function(){return this.https_protocol};e.prototype.to_json=function(){return{access_key:this.access_key,secret_key:this.secret_key,region:this.region,version:this.version,https_protocol:this.https_protocol}};e.from_json=function(a){return a?
new e(a.access_key,a.secret_key,a.region,a.version,a.https_protocol):null};return e}();var AwsUtils;
AwsUtils=function(){var e,a,b,d,f;f=function(c){c=c.toString();if(c.length<2)c="0"+c;return c};d=function(c){return[c.getUTCFullYear(),f(c.getUTCMonth()+1),f(c.getUTCDate())].join("-")};e=function(c){return[f(c.getUTCHours()),f(c.getUTCMinutes()),f(c.getUTCSeconds())].join(":")};b=function(c,k){return c===k?0:c.toLowerCase()>k.toLowerCase()?1:-1};a={};a.date_time_format=function(c){if(c==null)c=new Date;return""+d(c)+"T"+e(c)+".000Z"};a.generate_sig=function(c,k){var l,p,o;p=function(){var m;m=[];
for(l in c)m.push(l);return m}();p.sort(b);o=function(){var m,t,v;v=[];m=0;for(t=p.length;m<t;m++){l=p[m];v.push(""+l+c[l])}return v}();return SHA1.b64_hmac_sha1(k,o.join(""))};return a}();var SimpleDB,__indexOf=Array.prototype.indexOf||function(e){for(var a=0,b=this.length;a<b;a++)if(this[a]===e)return a;return-1};
SimpleDB=function(){function e(a,b){this.profile=a;this.protocol=(this.secure=b!=null?b:false)?"https":"http";this.endpoint=this.profile.get_settings().get_region();this.sdb_base_url=""+this.protocol+"://"+this.endpoint+"?"}e.prototype.set_profile=function(a){return this.profile=a};e.prototype.default_callback=function(a){return console.log(a)};e.prototype.build_request_url=function(a,b){var d,f;b.Action=a;b.Timestamp=AwsUtils.date_time_format();b.AWSAccessKeyId=this.profile.get_settings().get_access_key();
b.Version=this.profile.get_settings().get_version();b.SignatureVersion=1;b.Signature=AwsUtils.generate_sig(b,this.profile.get_settings().get_secret_key());return this.sdb_base_url+function(){var c;c=[];for(d in b){f=b[d];c.push(d+"="+encodeURIComponent(f))}return c}().join("&")};e.regions=function(){return[{name:"US East (Northern Virginia) Region",endpoint:"sdb.amazonaws.com"},{name:"US West (Oregon) Region",endpoint:"sdb.us-west-2.amazonaws.com"},{name:"US West (Northern California) Region",endpoint:"sdb.us-west-1.amazonaws.com"},
{name:"EU (Ireland) Region",endpoint:"sdb.eu-west-1.amazonaws.com"},{name:"Asia Pacific (Singapore) Region",endpoint:"sdb.ap-southeast-1.amazonaws.com"},{name:"Asia Pacific (Tokyo) Region",endpoint:"sdb.ap-northeast-1.amazonaws.com"}]};e.parse_metadata=function(a,b,d){return{meta:{req_id:$("RequestId",a).text(),box_usage:parseFloat($("BoxUsage",a).text()),status:b,req_url:d}}};e.prototype.ajax_request=function(a,b,d,f){if(d==null)d="GET";if(f==null)f=b;return $.ajax({type:d,url:a,success:function(c,
k){return b(e.parse_metadata(c,k,a),c)},error:function(c,k){var l;l=e.parse_metadata(c.responseXML,k,a);l.error={msg:$("Message",c.responseXML).text(),code:$("Code",c.responseXML).text()};return f(l,c.responseXML)},dataType:"xml"})};e.prototype.list_domains=function(a,b,d){var f,c;if(a==null)a=this.default_callback;if(b==null)b=100;if(d==null)d=null;if(__indexOf.call(function(){c=[];for(f=1;f<=100;f++)c.push(f);return c}.apply(this),b)<0)throw"Max domains must be between 1 and 100";b={MaxNumberOfDomains:b};
if(d)b.NextToken=d;return this.ajax_request(this.build_request_url("ListDomains",b),function(k,l){var p;k.error!=null&&a(k);p=[];$("DomainName",l).each(function(){return p.push($(this).text())});k.domains=p;k.next_token=$("NextToken",l).text();return a(k)})};e.prototype.domain_metadata=function(a,b){if(b==null)b=this.default_callback;return this.ajax_request(this.build_request_url("DomainMetadata",{DomainName:a}),function(d,f){d.error!=null&&b(d);d.creation_date_time=$("CreationDateTime",f).text();
d.item_count=parseInt($("ItemCount",f).text());d.item_names_size_bytes=parseInt($("ItemNamesSizeBytes",f).text());d.attribute_name_count=parseInt($("AttributeNameCount",f).text());d.attribute_names_size_bytes=parseInt($("AttributeNamesSizeBytes",f).text());d.attribute_value_count=parseInt($("AttributeValueCount",f).text());d.attribute_values_size_bytes=parseInt($("AttributeValuesSizeBytes",f).text());d.timestamp=$("Timestamp",f).text();return b(d)})};e.prototype.select=function(a,b,d){if(b==null)b=
this.default_callback;if(d==null)d=null;a={SelectExpression:a};if(d)a.NextToken=d;return this.ajax_request(this.build_request_url("Select",a),function(f,c){var k,l,p;f.error!=null&&b(f);p=[];l={};$("Item",c).each(function(){var o;o={attrs:{},name:$("Name:first",$(this)).text()};$("Attribute",$(this)).each(function(){var m,t;m=$("Name",$(this)).text();l[m]=m;t=$("Value",$(this)).text();o.attrs[m]||(o.attrs[m]=[]);return o.attrs[m].push(t)});return p.push(o)});f.items=p;f.attr_names=function(){var o;
o=[];for(k in l)o.push(k);return o}();d=$("NextToken",c).text();if(d!=="")f.next_token=d;return b(f)})};e.prototype.get_attributes=function(a,b,d,f){var c;if(d==null)d=this.default_callback;if(f==null)f=[];b={DomainName:a,ItemName:b};a=0;for(c=f.length;0<=c?a<c:a>c;0<=c?a++:a--)b["AttributeName."+a]=f[a];return this.ajax_request(this.build_request_url("GetAttributes",b),function(k,l){var p;k.error!=null&&d(k);p={};$("Attribute",l).each(function(){var o,m;o=$("Name",$(this)).text();m=$("Value",$(this)).text();
p[o]||(p[o]=[]);return p[o].push(m)});k.attributes=p;return d(k)})};e.prototype.put_attributes=function(a,b,d,f){var c,k,l,p,o,m,t;if(f==null)f=this.default_callback;k={DomainName:a,ItemName:b};p=b=0;for(m=d.length;p<m;p++){a=d[p];c=a.values;o=0;for(t=c.length;o<t;o++){l=c[o];k["Attribute."+b+".Name"]=a.name;k["Attribute."+b+".Value"]=l;if(a.replace&&a.replace===true)k["Attribute."+b+".Replace"]=true;b+=1}}return this.ajax_request(this.build_request_url("PutAttributes",k),function(v){return f(v)})};
e.prototype.delete_attributes=function(a,b,d,f){var c,k,l,p,o,m,t;if(f==null)f=this.default_callback;k={DomainName:a,ItemName:b};p=b=0;for(m=d.length;p<m;p++){a=d[p];if(c=a.values){o=0;for(t=c.length;o<t;o++){l=c[o];k["Attribute."+b+".Name"]=a.name;k["Attribute."+b+".Value"]=l;b+=1}}else{k["Attribute."+b+".Name"]=a.name;b+=1}}return this.ajax_request(this.build_request_url("DeleteAttributes",k),function(v){return f(v)})};e.prototype.batch_delete_attributes=function(a,b,d){var f,c,k,l,p,o,m,t,v,r,
h;if(d==null)d=this.default_callback;l={DomainName:a};a=0;for(r=b.length;0<=r?a<r:a>r;0<=r?a++:a--){f=b[a];c=f.item_name;l["Item."+a+".ItemName"]=c;c=0;h=f.item_attrs;o=0;for(t=h.length;o<t;o++){f=h[o];if(k=f.values){m=0;for(v=k.length;m<v;m++){p=k[m];l["Item."+a+".Attribute."+c+".Name"]=f.name;l["Item."+a+".Attribute."+c+".Value"]=p;c+=1}}else{l["Item."+a+".Attribute."+c+".Name"]=f.name;c+=1}}}return this.ajax_request(this.build_request_url("BatchDeleteAttributes",l),function(i){return d(i)})};e.prototype.batch_put_attributes=
function(a,b,d){var f,c,k,l,p,o,m,t,v,r,h;if(d==null)d=this.default_callback;l={DomainName:a};a=0;for(r=b.length;0<=r?a<r:a>r;0<=r?a++:a--){f=b[a];c=f.item_name;l["Item."+a+".ItemName"]=c;c=0;h=f.item_attrs;o=0;for(t=h.length;o<t;o++){f=h[o];k=f.values;m=0;for(v=k.length;m<v;m++){p=k[m];l["Item."+a+".Attribute."+c+".Name"]=f.name;l["Item."+a+".Attribute."+c+".Value"]=p;if(f.replace&&f.replace===true)l["Item."+a+".Attribute."+c+".Replace"]=true;c+=1}}}return this.ajax_request(this.build_request_url("BatchPutAttributes",
l),function(i){return d(i)})};e.prototype.create_domain=function(a,b){if(b==null)b=this.default_callback;return this.ajax_request(this.build_request_url("CreateDomain",{DomainName:a}),function(d){return b(d)})};e.prototype.delete_domain=function(a,b){if(b==null)b=this.default_callback;return this.ajax_request(this.build_request_url("DeleteDomain",{DomainName:a}),function(d){return b(d)})};return e}();var Profile;
Profile=function(){function e(a,b){this.name=a;this.settings=b}e.prototype.use_name=function(a){this.name=a;return this};e.prototype.use_settings=function(a){this.settings=a;return this};e.prototype.get_name=function(){return this.name};e.prototype.get_settings=function(){return this.settings};e.prototype.make_primary=function(){Storage.set("chrome-sdb.primary-profile",this.name);return this};e.prototype.save=function(a){var b,d,f,c,k;if(a==null)a=false;f=e.find_all();b=false;c=0;for(k=f.length;c<
k;c++){d=f[c];if(this.name===d.get_name()){d.use_settings(this.settings);b=true}}b||f.push(this);Storage.set("chrome-sdb.profiles",e.profiles_json(f),true);if(e.primary()===null||a)this.make_primary();return this};e.prototype["delete"]=function(){e["delete"](this.name);return null};e.prototype.to_json=function(){return{name:this.name,settings:this.settings.to_json()}};e.primary=function(){var a;a=Storage.get("chrome-sdb.primary-profile");return e.find(a)};e.from_json=function(a){return a?new e(a.name,
Settings.from_json(a.settings)):null};e.find_all=function(){var a,b,d,f;b=(f=Storage.get("chrome-sdb.profiles",true))!=null?f:{};return function(){var c;c=[];for(a in b){d=b[a];c.push(new e(a,Settings.from_json(d)))}return c}()};e.find=function(a){var b,d,f,c;d=e.find_all();f=0;for(c=d.length;f<c;f++){b=d[f];if(b.get_name()===a)return b}return null};e.profiles_json=function(a){var b,d,f,c;d={};f=0;for(c=a.length;f<c;f++){b=a[f];d[b.get_name()]=b.get_settings().to_json()}return d};e.delete_all=function(){return Storage.set("chrome-sdb.profiles",
{},true)};e["delete"]=function(a){var b,d,f,c;f=e.find_all();d=[];b=0;for(c=f.length;0<=c?b<c:b>c;0<=c?b++:b--)f[b].get_name()!==a&&d.push(f[b]);return Storage.set("chrome-sdb.profiles",e.profiles_json(d),true)};return e}();var confirm_delete,delete_domain,disable_delete,enable_delete,handle_delete_toggle,handle_query,metadata,profile,query,save_domain,sdb,update_domains_table,update_region;if(profile=Profile.primary()){sdb=new SimpleDB(profile);$(function(){return update_domains_table()})}else chrome.tabs.create({url:"config.html"});
update_region=function(e){profile.get_settings().use_region(e);profile.save();sdb=new SimpleDB(profile);return update_domains_table()};$(function(){var e,a,b,d;d=SimpleDB.regions();a=0;for(b=d.length;a<b;a++){e=d[a];$("#region_select").append($("<option>",{value:e.endpoint}).text(e.name))}$("#region_select").val(profile.get_settings().get_region());return $("#region_select").change(function(){e=$("#region_select").val();return update_region(e)})});
update_domains_table=function(e){if(e==null)e=null;return sdb.list_domains(function(a){var b,d,f;f=a.domains;a=f.length===0?["<tr><td>No domains in this region</td></tr>"]:function(){var c,k,l;l=[];c=0;for(k=f.length;c<k;c++){d=f[c];b='<button id="metadata_'+d+'" class="btn info" onclick="metadata(\''+d+"')\">metadata</a>";b+=' <button id="delete_'+d+'" class="btn" onclick="confirm_delete(\''+d+'\')" disabled="disabled" style="margin-left:5px">delete</button>';l.push("<tr><td>"+d+"<br />"+b+"</td></tr>")}return l}();
$("#domains_table > tbody").html(a.join(""));if(e!=null)return e()})};enable_delete=function(){$("button[id^=delete_]").removeAttr("disabled").addClass("danger").removeClass("secondary");return $("#domain_deletion_control").text("Disable Delete").addClass("danger").removeClass("secondary").addClass("active")};disable_delete=function(){$("button[id^=delete_]").attr("disabled","disabled").addClass("secondary").removeClass("danger");return $("#domain_deletion_control").text("Enable Delete").addClass("secondary").removeClass("danger").removeClass("active")};
handle_delete_toggle=function(){return $("#domain_deletion_control").hasClass("active")?disable_delete():enable_delete()};
handle_query=function(e){var a,b,d,f,c,k;console.log(e);f=e.items.length;c=e.next_token;if(c!=null){c=c.replace(/\n/g,"");$("#next_page_btn").removeAttr("disabled").attr("onclick","query('"+c+"')")}else $("#next_page_btn").attr("disabled","disabled").removeAttr("onclick");if(f===0){$("#query_results_table > thead").html("<tr><th>Items</th></tr>");return $("#query_results_table > tbody").html("<tr><td>No results...</td></tr>")}else{f=function(){var l,p,o,m;o=e.attr_names;m=[];l=0;for(p=o.length;l<
p;l++){a=o[l];m.push("<th>"+a+"</th>")}return m}();c=function(){var l,p,o,m;o=e.items;m=[];l=0;for(p=o.length;l<p;l++){d=o[l];k=function(){var t,v,r,h;r=e.attr_names;h=[];t=0;for(v=r.length;t<v;t++){a=r[t];b=d.attrs[a];h.push(b!=null?b.length>1?"<td><table><tbody><tr><td>"+b.join("</td><td>")+"</td></tr></tbody></table></td>":"<td>"+b.join("")+"</td>":"<td></td>")}return h}();m.push("<tr><td>"+d.name+"</td>"+k.join("")+"</tr>")}return m}();$("#query_results_table > thead").html("<tr><th>Item Name</th>"+
f.join("")+"</tr>");$("#query_results_table > tbody").html(c.join(""));return $("#query_btn").button("reset")}};query=function(e){var a;if(e==null)e=null;a=$("#query_expr").val();sdb.select(a,handle_query,e);return $("#query_btn").button("loading")};
metadata=function(e){return sdb.domain_metadata(e,function(a){console.log("metadata",a);$("#domain_metadata_label").html("<h2>"+e+" <small>Metadata</small></h2>");$("input[name=itemCount]").val(a.item_count);$("input[name=itemNamesSizeBytes]").val(a.item_names_size_bytes);$("input[name=attributeNameCount]").val(a.attribute_name_count);$("input[name=attributeNamesSizeBytes]").val(a.attribute_names_size_bytes);$("input[name=attributeValueCount]").val(a.attribute_value_count);$("input[name=attributeValuesSizeBytes]").val(a.attribute_values_size_bytes);
return $("#domain_metadata_modal").modal("show")})};$(function(){return $("input[name=confirm_delete]").keydown(function(e){return $("input[name=confirm_delete]").val()==="DELET"&&e.keyCode===69?$("#confirm_delete_domain_btn").removeAttr("disabled").addClass("danger").removeClass("secondary"):$("#confirm_delete_domain_btn").attr("disabled","disabled").addClass("secondary").removeClass("danger")})});
confirm_delete=function(e){$("#domain_delete_label").html("<h2>Delete "+e+"?</h2>");$("input[name=confirm_delete]").val("");$("#confirm_delete_domain_btn").attr("onclick","delete_domain('"+e+"')");return $("#confirm_delete_domain_modal").modal("show")};delete_domain=function(e){$("#confirm_delete_domain_btn").button("loading");return sdb.delete_domain(e,function(){return update_domains_table(function(){$("#confirm_delete_domain_btn").button("reset");return disable_delete()})})};
save_domain=function(){var e;e=$("#domain_name").val();$("#save_domain").button("loading");return sdb.create_domain(e,function(){return update_domains_table(function(){$("#save_domain").button("reset");return $("#create_domain_modal").modal("hide")})})};})();
